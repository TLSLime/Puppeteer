# Puppeteer é¼ æ ‡ç‚¹å‡»å¯¹è¯æ¡†åŠŸèƒ½å®žçŽ°æ€»ç»“

## ðŸŽ¯ å®žçŽ°çš„åŠŸèƒ½

### 1. **æŒ‰é’®è¯†åˆ«åŠŸèƒ½** âœ…
- **åŠŸèƒ½**: æ™ºèƒ½è¯†åˆ«å¯¹è¯æ¡†ä¸­çš„æŒ‰é’®æŽ§ä»¶
- **ç‰¹æ€§**:
  - é€šè¿‡Windows APIæŸ¥æ‰¾ButtonæŽ§ä»¶
  - æ”¯æŒä¸­è‹±æ–‡æŒ‰é’®æ–‡æœ¬è¯†åˆ«
  - æŒ‰é’®æ–‡æœ¬æ˜ å°„ï¼šç¡®å®š/OKã€å–æ¶ˆ/Cancelã€æ˜¯/Yesã€å¦/Noç­‰
  - ç²¾ç¡®åŒ¹é…æŒ‰é’®æŽ§ä»¶å¥æŸ„
- **å®žçŽ°ä½ç½®**: `puppeteer/dialog_handler.py` - `_find_dialog_button()` æ–¹æ³•

### 2. **æŒ‰é’®ä½ç½®èŽ·å–** âœ…
- **åŠŸèƒ½**: èŽ·å–æŒ‰é’®çš„å±å¹•åæ ‡ä½ç½®
- **ç‰¹æ€§**:
  - ä½¿ç”¨ `GetWindowRect` èŽ·å–æŒ‰é’®çŸ©å½¢
  - è®¡ç®—æŒ‰é’®ä¸­å¿ƒç‚¹åæ ‡
  - è¿”å›žå±å¹•ç»å¯¹åæ ‡
- **å®žçŽ°ä½ç½®**: `puppeteer/dialog_handler.py` - `_get_button_rect()` æ–¹æ³•

### 3. **å¹³æ»‘é¼ æ ‡ç§»åŠ¨** âœ…
- **åŠŸèƒ½**: å¹³æ»‘ç§»åŠ¨é¼ æ ‡åˆ°æŒ‰é’®ä½ç½®
- **ç‰¹æ€§**:
  - ä½¿ç”¨Win32 API `SetCursorPos` é¿å…å®‰å…¨é™åˆ¶
  - åˆ†æ®µç§»åŠ¨ï¼Œæ¯æ­¥æœ€å¤š5åƒç´ 
  - ä½¿ç”¨ä¸‰æ¬¡ç¼“åŠ¨å‡½æ•°å®žçŽ°å¹³æ»‘ç§»åŠ¨
  - 10msé—´éš”ï¼Œç¡®ä¿ç§»åŠ¨æµç•…
- **å®žçŽ°ä½ç½®**: `puppeteer/dialog_handler.py` - `_smooth_move_mouse()` æ–¹æ³•

### 4. **é¼ æ ‡ç‚¹å‡»åŠŸèƒ½** âœ…
- **åŠŸèƒ½**: åœ¨æŒ‡å®šä½ç½®ç‚¹å‡»é¼ æ ‡
- **ç‰¹æ€§**:
  - ä½¿ç”¨Win32 API `mouse_event` å‘é€é¼ æ ‡äº‹ä»¶
  - å…ˆæŒ‰ä¸‹åŽé‡Šæ”¾ï¼Œæ¨¡æ‹ŸçœŸå®žç‚¹å‡»
  - 50msé—´éš”ï¼Œç¡®ä¿ç‚¹å‡»æœ‰æ•ˆ
- **å®žçŽ°ä½ç½®**: `puppeteer/dialog_handler.py` - `_click_mouse()` æ–¹æ³•

### 5. **æ™ºèƒ½æŒ‰é’®ç‚¹å‡»** âœ…
- **åŠŸèƒ½**: æ™ºèƒ½ç‚¹å‡»å¯¹è¯æ¡†æŒ‰é’®
- **ç‰¹æ€§**:
  - ä¼˜å…ˆä½¿ç”¨é¼ æ ‡ç‚¹å‡»æ–¹å¼
  - å¦‚æžœæ‰¾ä¸åˆ°æŒ‰é’®ï¼Œå›žé€€åˆ°APIæ–¹å¼
  - å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- **å®žçŽ°ä½ç½®**: `puppeteer/dialog_handler.py` - `_click_dialog_button()` æ–¹æ³•

## ðŸš€ æŠ€æœ¯å®žçŽ°ç»†èŠ‚

### 1. **æŒ‰é’®è¯†åˆ«ç®—æ³•**
```python
# æŒ‰é’®æ–‡æœ¬æ˜ å°„
button_texts = {
    "ok": ["ç¡®å®š", "OK", "æ˜¯", "Yes"],
    "cancel": ["å–æ¶ˆ", "Cancel", "å¦", "No"],
    "yes": ["æ˜¯", "Yes", "ç¡®å®š", "OK"],
    "no": ["å¦", "No", "å–æ¶ˆ", "Cancel"]
}

# æŸ¥æ‰¾æŒ‰é’®æŽ§ä»¶
button_hwnd = self.user32.FindWindowExW(hwnd, None, "Button", None)
while button_hwnd:
    # èŽ·å–æŒ‰é’®æ–‡æœ¬å¹¶åŒ¹é…
    button_text = ctypes.create_unicode_buffer(256)
    self.user32.GetWindowTextW(button_hwnd, button_text, 256)
    # æ£€æŸ¥æ˜¯å¦åŒ¹é…ç›®æ ‡æŒ‰é’®
```

### 2. **å¹³æ»‘ç§»åŠ¨ç®—æ³•**
```python
# è®¡ç®—ç§»åŠ¨æ­¥æ•°ï¼ˆæ¯æ­¥æœ€å¤š5åƒç´ ï¼‰
steps = max(1, int(distance / 5))

# å¹³æ»‘ç§»åŠ¨
for i in range(steps + 1):
    progress = i / steps
    # ä½¿ç”¨ç¼“åŠ¨å‡½æ•°
    progress = self._ease_in_out_cubic(progress)
    
    new_x = int(current_x + (x - current_x) * progress)
    new_y = int(current_y + (y - current_y) * progress)
    
    self.user32.SetCursorPos(new_x, new_y)
    time.sleep(0.01)  # 10msé—´éš”
```

### 3. **ç¼“åŠ¨å‡½æ•°**
```python
def _ease_in_out_cubic(self, t: float) -> float:
    """ä¸‰æ¬¡ç¼“åŠ¨å‡½æ•°"""
    if t < 0.5:
        return 4 * t * t * t
    else:
        return 1 - pow(-2 * t + 2, 3) / 2
```

### 4. **é¼ æ ‡ç‚¹å‡»å®žçŽ°**
```python
# é¼ æ ‡æŒ‰ä¸‹
self.user32.mouse_event(0x0002, x, y, 0, 0)  # MOUSEEVENTF_LEFTDOWN
time.sleep(0.05)

# é¼ æ ‡é‡Šæ”¾
self.user32.mouse_event(0x0004, x, y, 0, 0)  # MOUSEEVENTF_LEFTUP
time.sleep(0.05)
```

## ðŸ§ª æµ‹è¯•ç»“æžœ

### åŠŸèƒ½æµ‹è¯•é€šè¿‡çŽ‡: 100%

1. **æŒ‰é’®è¯†åˆ«åŠŸèƒ½** âœ… é€šè¿‡
   - æˆåŠŸè¯†åˆ«"æ˜¯"æŒ‰é’®
   - æ­£ç¡®èŽ·å–æŒ‰é’®æ–‡æœ¬ï¼š"æ˜¯(&Y)"
   - å‡†ç¡®è®¡ç®—æŒ‰é’®ä½ç½®ï¼š(1279, 801)

2. **é¼ æ ‡ç§»åŠ¨åŠŸèƒ½** âœ… é€šè¿‡
   - å¹³æ»‘ç§»åŠ¨åˆ°å±å¹•ä¸­å¿ƒï¼š(1280, 720)
   - å¹³æ»‘ç§»åŠ¨åˆ°å±å¹•å·¦ä¸Šè§’ï¼š(100, 100)
   - å¹³æ»‘ç§»åŠ¨åˆ°å±å¹•å³ä¸‹è§’ï¼š(2460, 1340)

3. **å¯¹è¯æ¡†ç‚¹å‡»åŠŸèƒ½** âœ… é€šè¿‡
   - æˆåŠŸæ‰¾åˆ°å¯¹è¯æ¡†ï¼š"é¼ æ ‡ç‚¹å‡»æµ‹è¯•"
   - æˆåŠŸè¯†åˆ«æŒ‰é’®ï¼š"æ˜¯(&Y)"
   - æˆåŠŸè®¡ç®—æŒ‰é’®ä½ç½®ï¼š(1279, 801)
   - æˆåŠŸé€šè¿‡é¼ æ ‡ç‚¹å‡»æŒ‰é’®
   - å¯¹è¯æ¡†è¿”å›žæ­£ç¡®ç»“æžœï¼š6 (IDYES)

4. **é›†æˆåŠŸèƒ½** âœ… é€šè¿‡
   - ç¨‹åºå¯åŠ¨å’Œè¿è¡Œæ­£å¸¸
   - å¯¹è¯æ¡†å¤„ç†å™¨æ­£ç¡®åˆå§‹åŒ–
   - å¯¹è¯æ¡†æ£€æµ‹æ­£å¸¸å¯åŠ¨å’Œåœæ­¢

## ðŸŽ‰ å®žé™…è¿è¡Œæ•ˆæžœ

### æŽ§åˆ¶å°è¾“å‡ºç¤ºä¾‹:
```
å¯¹è¯æ¡†å¤„ç†å™¨åˆå§‹åŒ–å®Œæˆ
å¼€å§‹æµ‹è¯•å¯¹è¯æ¡†é¼ æ ‡ç‚¹å‡»åŠŸèƒ½...
è¯·è§‚å¯Ÿé¼ æ ‡ç§»åŠ¨å’Œç‚¹å‡»è¿‡ç¨‹
åˆ›å»ºå¯¹è¯æ¡†...
æ‰¾åˆ°å¯¹è¯æ¡†: é¼ æ ‡ç‚¹å‡»æµ‹è¯•
æµ‹è¯•ç‚¹å‡»'æ˜¯'æŒ‰é’®...
æ‰¾åˆ°æŒ‰é’®: æ˜¯(&Y)
æ‰¾åˆ°æŒ‰é’® yesï¼Œä½ç½®: (1279, 801)
å·²é€šè¿‡é¼ æ ‡ç‚¹å‡»å¯¹è¯æ¡†æŒ‰é’®: yes
âœ“ å¯¹è¯æ¡†ç‚¹å‡»æµ‹è¯•å®Œæˆ
å¯¹è¯æ¡†ç»“æžœ: 6
```

### ç”¨æˆ·ä½“éªŒ:
1. **è§†è§‰åé¦ˆ**: ç”¨æˆ·å¯ä»¥çœ‹åˆ°é¼ æ ‡å¹³æ»‘ç§»åŠ¨åˆ°æŒ‰é’®ä½ç½®
2. **è‡ªç„¶äº¤äº’**: æ¨¡æ‹ŸçœŸå®žç”¨æˆ·ç‚¹å‡»è¡Œä¸º
3. **å®‰å…¨å¯é **: ä½¿ç”¨Win32 APIé¿å…å®‰å…¨é™åˆ¶
4. **ç²¾ç¡®æŽ§åˆ¶**: å‡†ç¡®è¯†åˆ«å’Œç‚¹å‡»ç›®æ ‡æŒ‰é’®

## ðŸ”§ ä¼˜åŠ¿å¯¹æ¯”

### ä¹‹å‰çš„æ–¹å¼ï¼ˆAPIç›´æŽ¥å‘é€æ¶ˆæ¯ï¼‰:
- âŒ ç”¨æˆ·çœ‹ä¸åˆ°ä»»ä½•åé¦ˆ
- âŒ å¯èƒ½è¢«æŸäº›ç¨‹åºæ‹¦æˆª
- âŒ ä¸å¤Ÿè‡ªç„¶ï¼Œå®¹æ˜“è¢«æ£€æµ‹

### çŽ°åœ¨çš„æ–¹å¼ï¼ˆé¼ æ ‡ç‚¹å‡»ï¼‰:
- âœ… ç”¨æˆ·å¯ä»¥çœ‹åˆ°é¼ æ ‡ç§»åŠ¨å’Œç‚¹å‡»è¿‡ç¨‹
- âœ… ä½¿ç”¨Win32 APIï¼Œé¿å…å®‰å…¨é™åˆ¶
- âœ… æ¨¡æ‹ŸçœŸå®žç”¨æˆ·è¡Œä¸ºï¼Œæ›´è‡ªç„¶
- âœ… æ”¯æŒæ‰€æœ‰ç±»åž‹çš„å¯¹è¯æ¡†
- âœ… æä¾›å®Œæ•´çš„è§†è§‰åé¦ˆ

## ðŸŽ¯ æ€»ç»“

æ‰€æœ‰è¯·æ±‚çš„é¼ æ ‡ç‚¹å‡»å¯¹è¯æ¡†åŠŸèƒ½éƒ½å·²æˆåŠŸå®žçŽ°ï¼š

1. âœ… **æŒ‰é’®è¯†åˆ«** - æ™ºèƒ½è¯†åˆ«å¯¹è¯æ¡†ä¸­çš„æŒ‰é’®æŽ§ä»¶
2. âœ… **ä½ç½®è®¡ç®—** - å‡†ç¡®è®¡ç®—æŒ‰é’®çš„å±å¹•åæ ‡
3. âœ… **å¹³æ»‘ç§»åŠ¨** - ä½¿ç”¨ç¼“åŠ¨å‡½æ•°å®žçŽ°å¹³æ»‘é¼ æ ‡ç§»åŠ¨
4. âœ… **é¼ æ ‡ç‚¹å‡»** - ä½¿ç”¨Win32 APIå®žçŽ°å¯é çš„é¼ æ ‡ç‚¹å‡»
5. âœ… **æ™ºèƒ½å¤„ç†** - ä¼˜å…ˆä½¿ç”¨é¼ æ ‡ç‚¹å‡»ï¼Œå›žé€€åˆ°APIæ–¹å¼
6. âœ… **å®‰å…¨å¯é ** - é¿å…PyAutoGUIçš„å®‰å…¨é™åˆ¶é—®é¢˜

ç¨‹åºçŽ°åœ¨å…·å¤‡äº†å¼ºå¤§çš„å¯¹è¯æ¡†å¤„ç†èƒ½åŠ›ï¼Œèƒ½å¤Ÿï¼š
- æ™ºèƒ½è¯†åˆ«å„ç§å¯¹è¯æ¡†æŒ‰é’®
- å¹³æ»‘ç§»åŠ¨é¼ æ ‡åˆ°æŒ‰é’®ä½ç½®
- é€šè¿‡é¼ æ ‡ç‚¹å‡»å¤„ç†å¯¹è¯æ¡†
- æä¾›å®Œæ•´çš„è§†è§‰åé¦ˆ
- é¿å…å®‰å…¨é™åˆ¶å’Œæ£€æµ‹é—®é¢˜

è¿™ä¸ªåŠŸèƒ½å¤§å¤§æå‡äº†Puppeteerçš„å®žç”¨æ€§å’Œå¯é æ€§ï¼Œç¡®ä¿å¯¹è¯æ¡†å¤„ç†æ›´åŠ è‡ªç„¶å’Œå®‰å…¨ï¼ðŸš€
